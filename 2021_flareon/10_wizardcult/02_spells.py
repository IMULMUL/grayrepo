SPELLS = {}
SPELLS["Eldritch Blast"] = 0
SPELLS["Mass Heal"] = 1
SPELLS["Fireball"] = 2
SPELLS["Dominate Monster"] = 3
SPELLS["Detect Magic"] = 4
SPELLS["Stone Shape"] = 5
SPELLS["Clairvoyance"] = 6
SPELLS["Aid"] = 7
SPELLS["Detect Thoughts"] = 8
SPELLS["Shapechange"] = 9
SPELLS["Fire Shield"] = 10
SPELLS["Pass without Trace"] = 11
SPELLS["Antipathy/Sympathy"] = 12
SPELLS["Sleet Storm"] = 13
SPELLS["Dominate Person"] = 14
SPELLS["Tree Stride"] = 15
SPELLS["Passwall"] = 0x10
SPELLS["Shatter"] = 0x11
SPELLS["Giant Insect"] = 0x12
SPELLS["Revivify"] = 0x13
SPELLS["Circle of Death"] = 0x14
SPELLS["Divination"] = 0x15
SPELLS["Comprehend Languages"] = 0x16
SPELLS["Faerie Fire"] = 0x17
SPELLS["True Polymorph"] = 0x18
SPELLS["Searing Smite"] = 0x19
SPELLS["Dimension Door"] = 0x1a
SPELLS["Shield"] = 0x1b
SPELLS["Enlarge/Reduce"] = 0x1c
SPELLS["Illusory Script"] = 0x1d
SPELLS["Resistance"] = 0x1e
SPELLS["Earthquake"] = 0x1f
SPELLS["Contagion"] = 0x20
SPELLS["Bless"] = 0x21
SPELLS["Raise Dead"] = 0x22
SPELLS["Guidance"] = 0x23
SPELLS["Expeditious Retreat"] = 0x24
SPELLS["Grease"] = 0x25
SPELLS["Message"] = 0x26
SPELLS["Elemental Weapon"] = 0x27
SPELLS["Fear"] = 0x28
SPELLS["Clone"] = 0x29
SPELLS["Wrathful Smite"] = 0x2a
SPELLS["Astral Projection"] = 0x2b
SPELLS["Flaming Sphere"] = 0x2c
SPELLS["Disguise Self"] = 0x2d
SPELLS["Maze"] = 0x2e
SPELLS["Slow"] = 0x2f
SPELLS["Polymorph"] = 0x30
SPELLS["Weird"] = 0x31
SPELLS["Finger of Death"] = 0x32
SPELLS["Protection from Energy"] = 0x33
SPELLS["Nondetection"] = 0x34
SPELLS["Animal Friendship"] = 0x35
SPELLS["Spike Growth"] = 0x36
SPELLS["Goodberry"] = 0x37
SPELLS["Calm Emotions"] = 0x38
SPELLS["Antilife Shell"] = 0x39
SPELLS["Cone of Cold"] = 0x3a
SPELLS["Identify"] = 0x3b
SPELLS["Power Word Stun"] = 0x3c
SPELLS["Control Water"] = 0x3d
SPELLS["Thorn Whip"] = 0x3e
SPELLS["Power Word Kill"] = 0x3f
SPELLS["Blink"] = 0x40
SPELLS["Locate Creature"] = 0x41
SPELLS["Command"] = 0x42
SPELLS["Contingency"] = 0x43
SPELLS["Prismatic Wall"] = 0x44
SPELLS["Blade Ward"] = 0x45
SPELLS["Scrying"] = 0x46
SPELLS["Dominate Beast"] = 0x47
SPELLS["Sacred Flame"] = 0x48
SPELLS["Guards and Wards"] = 0x49
SPELLS["Arcane Eye"] = 0x4a
SPELLS["Mirage Arcane"] = 0x4b
SPELLS["Magic Mouth"] = 0x4c
SPELLS["Glyph of Warding"] = 0x4d
SPELLS["Friends"] = 0x4e
SPELLS["Sending"] = 0x4f
SPELLS["Stinking Cloud"] = 0x50
SPELLS["Compulsion"] = 0x51
SPELLS["Dancing Lights"] = 0x52
SPELLS["Darkness"] = 0x53
SPELLS["Invisibility"] = 0x54
SPELLS["Spare the Dying"] = 0x55
SPELLS["Wall of Fire"] = 0x56
SPELLS["Flame Blade"] = 0x57
SPELLS["Feather Fall"] = 0x58
SPELLS["Magic Weapon"] = 0x59
SPELLS["Purify Food and Drink"] = 0x5a
SPELLS["Spirit Guardians"] = 0x5b
SPELLS["Witch Bolt"] = 0x5c
SPELLS["Animate Objects"] = 0x5d
SPELLS["Gaseous Form"] = 0x5e
SPELLS["Lightning Bolt"] = 0x5f
SPELLS["Move Earth"] = 0x60
SPELLS["Disintegrate"] = 0x61
SPELLS["Mass Healing Word"] = 0x62
SPELLS["Meld into Stone"] = 0x63
SPELLS["Hellish Rebuke"] = 0x64
SPELLS["Aura of Life"] = 0x65
SPELLS["Augury"] = 0x66
SPELLS["Conjure Elemental"] = 0x67
SPELLS["Spider Climb"] = 0x68
SPELLS["Hold Person"] = 0x69
SPELLS["Project Image"] = 0x6a
SPELLS["Heroism"] = 0x6b
SPELLS["Crown of Madness"] = 0x6c
SPELLS["Mirror Image"] = 0x6d
SPELLS["Ray of Sickness"] = 0x6e
SPELLS["Bane"] = 0x6f
SPELLS["Wish"] = 0x70
SPELLS["Contact Other Plane"] = 0x71
SPELLS["Etherealness"] = 0x72
SPELLS["Blinding Smite"] = 0x73
SPELLS["Shield of Faith"] = 0x74
SPELLS["Vampiric Touch"] = 0x75
SPELLS["Shillelagh"] = 0x76
SPELLS["Programmed Illusion"] = 0x77
SPELLS["Remove Curse"] = 0x78
SPELLS["Major Image"] = 0x79
SPELLS["Insect Plague"] = 0x7a
SPELLS["Color Spray"] = 0x7b
SPELLS["Prismatic Spray"] = 0x7c
SPELLS["Charm Person"] = 0x7d
SPELLS["Arms of Hadar"] = 0x7e
SPELLS["Dream"] = 0x7f
SPELLS["Dissonant Whispers"] = 0x80
SPELLS["Teleport"] = 0x81
SPELLS["Dispel Magic"] = 0x82
SPELLS["Forbiddance"] = 0x83
SPELLS["Misty Step"] = 0x84
SPELLS["Cloud of Daggers"] = 0x85
SPELLS["Gentle Repose"] = 0x86
SPELLS["Phantasmal Force"] = 0x87
SPELLS["Circle of Power"] = 0x88
SPELLS["Stoneskin"] = 0x89
SPELLS["Sunbeam"] = 0x8a
SPELLS["Fire Storm"] = 0x8b
SPELLS["Gust of Wind"] = 0x8c
SPELLS["Find Steed"] = 0x8d
SPELLS["Druidcraft"] = 0x8e
SPELLS["Confusion"] = 0x8f
SPELLS["Bestow Curse"] = 0x90
SPELLS["Flesh to Stone"] = 0x91
SPELLS["Arcane Gate"] = 0x92
SPELLS["Ray of Frost"] = 0x93
SPELLS["Greater Invisibility"] = 0x94
SPELLS["Regenerate"] = 0x95
SPELLS["Burning Hands"] = 0x96
SPELLS["Wall of Ice"] = 0x97
SPELLS["True Strike"] = 0x98
SPELLS["Silence"] = 0x99
SPELLS["Banishing Smite"] = 0x9a
SPELLS["Commune with Nature"] = 0x9b
SPELLS["Time Stop"] = 0x9c
SPELLS["Conjure Celestial"] = 0x9d
SPELLS["Magic Jar"] = 0x9e
SPELLS["True Seeing"] = 0x9f
SPELLS["Transport via Plants"] = 0xa0
SPELLS["Teleportation Circle"] = 0xa1
SPELLS["Spiritual Weapon"] = 0xa2
SPELLS["Prayer of Healing"] = 0xa3
SPELLS["Awaken"] = 0xa4
SPELLS["Conjure Woodland Beings"] = 0xa5
SPELLS["Cloudkill"] = 0xa6
SPELLS["Imprisonment"] = 0xa7
SPELLS["Branding Smite"] = 0xa8
SPELLS["Ray of Enfeeblement"] = 0xa9
SPELLS["See Invisibility"] = 0xaa
SPELLS["Word of Recall"] = 0xab
SPELLS["Silent Image"] = 0xac
SPELLS["Eyebite"] = 0xad
SPELLS["Cordon of Arrows"] = 0xae
SPELLS["Globe of Invulnerability"] = 0xaf
SPELLS["Wind Walk"] = 0xb0
SPELLS["Continual Flame"] = 0xb1
SPELLS["Power Word Heal"] = 0xb2
SPELLS["Web"] = 0xb3
SPELLS["Protection from Poison"] = 0xb4
SPELLS["Grasping Vine"] = 0xb5
SPELLS["Telekinesis"] = 0xb6
SPELLS["Heat Metal"] = 0xb7
SPELLS["Harm"] = 0xb8
SPELLS["Antimagic Field"] = 0xb9
SPELLS["Jump"] = 0xba
SPELLS["Greater Restoration"] = 0xbb
SPELLS["Chain Lightning"] = 0xbc
SPELLS["Knock"] = 0xbd
SPELLS["Blade Barrier"] = 0xbe
SPELLS["Scorching Ray"] = 0xbf
SPELLS["Zone of Truth"] = 0xc0
SPELLS["Moonbeam"] = 0xc1
SPELLS["Light"] = 0xc2
SPELLS["Magic Circle"] = 0xc3
SPELLS["Hail of Thorns"] = 0xc4
SPELLS["Heal"] = 0xc5
SPELLS["Blur"] = 0xc6
SPELLS["Water Breathing"] = 0xc7
SPELLS["Cure Wounds"] = 0xc8
SPELLS["Enhance Ability"] = 0xc9
SPELLS["Suggestion"] = 0xca
SPELLS["Water Walk"] = 0xcb
SPELLS["Conjure Barrage"] = 0xcc
SPELLS["Arcane Lock"] = 0xcd
SPELLS["Reverse Gravity"] = 0xce
SPELLS["Planar Ally"] = 0xcf
SPELLS["Mass Suggestion"] = 0xd0
SPELLS["False Life"] = 0xd1
SPELLS["Longstrider"] = 0xd2
SPELLS["Detect Evil and Good"] = 0xd3
SPELLS["Guiding Bolt"] = 0xd4
SPELLS["Glibness"] = 0xd5
SPELLS["Speak with Dead"] = 0xd6
SPELLS["Call Lightning"] = 0xd7
SPELLS["Death Ward"] = 0xd8
SPELLS["Create Undead"] = 0xd9
SPELLS["Beacon of Hope"] = 0xda
SPELLS["Alter Self"] = 0xdb
SPELLS["Acid Splash"] = 0xdc
SPELLS["Phantom Steed"] = 0xdd
SPELLS["Planar Binding"] = 0xde
SPELLS["Prestidigitation"] = 0xdf
SPELLS["Animate Dead"] = 0xe0
SPELLS["Mind Blank"] = 0xe1
SPELLS["Sleep"] = 0xe2
SPELLS["Divine Favor"] = 0xe3
SPELLS["Telepathy"] = 0xe4
SPELLS["Vicious Mockery"] = 0xe5
SPELLS["Blight"] = 0xe6
SPELLS["Barkskin"] = 0xe7
SPELLS["Counterspell"] = 0xe8
SPELLS["Conjure Fey"] = 0xe9
SPELLS["Find Traps"] = 0xea
SPELLS["Animal Shapes"] = 0xeb
SPELLS["Speak with Plants"] = 0xec
SPELLS["True Resurrection"] = 0xed
SPELLS["Warding Bond"] = 0xee
SPELLS["Flame Strike"] = 0xef
SPELLS["Healing Word"] = 0xf0
SPELLS["Wall of Thorns"] = 0xf1
SPELLS["Wind Wall"] = 0xf2
SPELLS["Seeming"] = 0xf3
SPELLS["Chill Touch"] = 0xf4
SPELLS["Lesser Restoration"] = 0xf5
SPELLS["Guardian of Faith"] = 0xf6
SPELLS["Meteor Swarm"] = 0xf7
SPELLS["Shocking Grasp"] = 0xf8
SPELLS["Commune"] = 0xf9
SPELLS["Destructive Wave"] = 0xfa
SPELLS["Staggering Smite"] = 0xfb
SPELLS["Create or Destroy Water"] = 0xfc
SPELLS["Sunburst"] = 0xfd
SPELLS["Forcecage"] = 0xfe
SPELLS["Tongues"] = 0xff

import re
import hashlib

def decode_spells(data):
	global SPELLS

	output = bytearray()
	lines = data.split("\n")
	for line in lines:
		pos1 = line.find("I cast ")
		pos2 = line.find(" on the ")
		spellname = line[pos1+len("I cast "):pos2]
		#print(spellname)
		output.append(SPELLS[spellname])
		

		pos3 = line.find("for ")
		if pos3 != -1:
			pos4 = line.find(" damage", pos3)
			diceroll = line[pos3+len("for "):pos4]
			dices = diceroll.split("d")
			#print(dices)
			output.append(int(dices[0]))
			output.append(int(dices[1]))

	return bytes(output)


def main():

	
	# First spell fight (Cmdline ls)
	with open("spellcast1.txt", "r") as f:
		data = f.read()

	fight1 = decode_spells(data)
	out = bytearray()
	for i in range(len(fight1)):
		out.append(fight1[i] ^ 0xa2)
	print(bytes(out))

	# Second spell fight (fileread png)
	with open("spellcast2.txt", "r") as f:
		data = f.read()
	fight2 = decode_spells(data)
	print(fight2[:0x200])
	print(len(fight2))
	with open("encrypted.png", "wb") as f:
		f.write(fight2)
	print("Spellfight 2 written to file")
	
	# testing data with running 256 bytes
	with open("running_example.txt", "r") as f:
		data = f.read()
	fight3 = decode_spells(data)
	print(fight3)
	print(len(fight3))
	print(hashlib.sha1(fight3).hexdigest())

	print("")
	ROM1 = [90, 132, 6, 69, 174, 203, 232, 243, 87, 254, 166, 61, 94, 65, 8, 208, 51, 34, 33, 129, 32, 221, 0, 160, 35, 175, 113, 4, 139, 245, 24, 29, 225, 15, 101, 9, 206, 66, 120, 62, 195, 55, 202, 143, 100, 50, 224, 172, 222, 145, 124, 42, 192, 7, 244, 149, 159, 64, 83, 229, 103, 182, 122, 82, 78, 63, 131, 75, 201, 130, 114, 46, 118, 28, 241, 30, 204, 183, 215, 199, 138, 16, 121, 26, 77, 25, 53, 22, 125, 67, 43, 205, 134, 171, 68, 146, 212, 14, 152, 20]
	print(len(ROM1))
	ROM2 = [185, 155, 167, 36, 27, 60, 226, 58, 211, 240, 253, 79, 119, 209, 163, 12, 72, 128, 106, 218, 189, 216, 71, 91, 250, 150, 11, 236, 207, 73, 217, 17, 127, 177, 39, 231, 197, 178, 99, 230, 40, 54, 179, 93, 251, 220, 168, 112, 37, 246, 176, 156, 165, 95, 184, 57, 228, 133, 169, 252, 19, 2, 81, 48, 242, 105, 255, 116, 191, 89, 181, 70, 23, 194, 88, 97, 153, 235, 164, 158, 137, 238, 108, 239, 162, 144, 115, 140, 84, 188, 109, 219, 44, 214, 227, 161, 141, 80, 247, 52]
	print(len(ROM2))
	ROM3 = [213, 249, 1, 123, 142, 190, 104, 107, 85, 157, 45, 237, 47, 147, 21, 31, 196, 136, 170, 248, 13, 92, 234, 86, 3, 193, 154, 56, 5, 111, 98, 74, 18, 223, 96, 148, 41, 117, 126, 173, 233, 10, 49, 180, 187, 186, 135, 59, 38, 210, 110, 102, 200, 76, 151, 198]
	print(len(ROM3))
	ROM4 = [97, 49, 49, 95, 109, 89, 95, 104, 111, 109, 49, 101, 115, 95, 104, 52, 116, 51, 95, 98, 52, 114, 100, 115]
	print(len(ROM4))
	print("".join([chr(x) for x in ROM4]))

if __name__ == "__main__":
	main()
